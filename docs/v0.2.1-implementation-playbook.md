# V0.2.1 Implementation Playbook (Agent-Executable)

## 1. Objective

Ship the first real scan release using mature scanners:

`GitHub repo intake -> Semgrep + Gitleaks -> normalized findings -> existing report flow`

## 2. Scope

1. Real GitHub repository intake
2. Semgrep adapter integration
3. Gitleaks adapter integration
4. Finding normalization and merge
5. Backward-compatible API/report behavior
6. Authenticated GitHub API mode (`GITHUB_TOKEN`)

## 3. Target Files

```txt
skill-security-scan/
  lib/
    scan/
      github.ts                  # new
      adapters/
        semgrep.ts               # new
        gitleaks.ts              # new
        normalize.ts             # new
      engine.ts                  # update engineVersion path
    store.ts                     # replace mock pipeline entry
  app/api/scan/route.ts          # keep error contract stable
  tests/
    github.test.ts               # new
    adapters.test.ts             # new
    api.test.ts                  # update
    engine.test.ts               # update
```

## 4. Task Breakdown

## Task A: Build GitHub Intake

1. Parse supported GitHub URLs.
2. Fetch tree/blob content via API.
3. Apply file extension/dir/size/timeout limits.
4. Support Authorization header when `GITHUB_TOKEN` is configured.

Done when:

1. Valid public repos produce bounded file lists.
2. Timeout path is deterministic and testable.
3. Authenticated and unauthenticated paths both work.

## Task B: Add Semgrep Adapter

1. Run Semgrep command and parse JSON.
2. Normalize results into internal `Finding`.
3. Handle command absence/failure safely.

Done when:

1. Semgrep findings show in merged report.
2. Adapter unit tests pass.

## Task C: Add Gitleaks Adapter

1. Run Gitleaks command and parse JSON.
2. Normalize results into internal `Finding`.
3. Handle command absence/failure safely.

Done when:

1. Gitleaks findings show in merged report.
2. Adapter unit tests pass.

## Task D: Wire Pipeline

1. Replace mock source with GitHub intake.
2. Merge internal + external scanner findings.
3. Set `engineVersion = v0.2.1`.

Done when:

1. `POST /api/scan` and `GET /api/scan/:id` output merged findings.
2. Report and poster pages render unchanged.

## Task E: Test and Validate

1. Run:
   - `tests/github.test.ts`
   - `tests/adapters.test.ts`
   - `tests/api.test.ts`
   - `tests/engine.test.ts`
2. Manual check on 3 public repos:
   - low-risk
   - risky
   - medium-size
3. Token-mode validation:
   - run with `GITHUB_TOKEN` and verify GitHub rate-limit behavior improves

Done when:

1. `npm test` is green.
2. Validation includes both Semgrep and Gitleaks outputs.
3. Token-enabled run completes successfully.

## 5. Release Checklist

1. `engineVersion` is `v0.2.1`.
2. External scanner findings exist in report payload.
3. No report/poster contract regression.
4. V0.2.1 spec acceptance gate fully passes.
5. `GITHUB_TOKEN` usage is documented in runtime setup notes.
